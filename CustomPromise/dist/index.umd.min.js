/*!
 * @nikunjdaga/promiz v1.0.0
 * (c) 2025 Nikunj Daga
 * Released under the MIT License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).MyPromise=t()}(this,function(){"use strict";class e{static states={PENDING:"pending",FULFILLED:"fulfilled",REJECTED:"rejected"};static unhandledRejections=(()=>new Set)();static onUnhandledRejection=(e,t)=>{console.warn("Unhandled promise rejection:",e)};constructor(t){if("function"!=typeof t)throw new TypeError("Promise resolver must be a function");this.state=e.states.PENDING,this.value=void 0,this.reason=void 0,this.onFulfilledCallbacks=[],this.onRejectedCallbacks=[];const n=t=>{if(this.state===e.states.PENDING){if(t&&("object"==typeof t||"function"==typeof t))try{const e=t.then;if("function"==typeof e)return void e.call(t,e=>n(e),e=>o(e))}catch(e){return void o(e)}this.state=e.states.FULFILLED,this.value=t,this.triggerCallbacks()}},o=t=>{this.state===e.states.PENDING&&(this.state=e.states.REJECTED,this.reason=t,e.unhandledRejections.add(this),queueMicrotask(()=>{e.unhandledRejections.has(this)&&(e.onUnhandledRejection(t,this),e.unhandledRejections.delete(this))}),this.triggerCallbacks())};try{t(n,o)}catch(e){o(e)}}triggerCallbacks(){this.state===e.states.FULFILLED?this.onFulfilledCallbacks.forEach(e=>e()):this.state===e.states.REJECTED&&this.onRejectedCallbacks.forEach(e=>e()),this.onFulfilledCallbacks=[],this.onRejectedCallbacks=[]}then(t,n){t="function"==typeof t?t:e=>e,n="function"==typeof n?n:e=>{throw e};const o=new e((r,s)=>{const i=()=>{queueMicrotask(()=>{try{const e=t(this.value);this.resolvePromise(o,e,r,s)}catch(e){s(e)}})},a=()=>{queueMicrotask(()=>{e.unhandledRejections.delete(this);try{const e=n(this.reason);this.resolvePromise(o,e,r,s)}catch(e){s(e)}})};this.state===e.states.FULFILLED?i():this.state===e.states.REJECTED?a():(this.onFulfilledCallbacks.push(i),this.onRejectedCallbacks.push(a))});return o}catch(e){return this.then(null,e)}finally(t){return this.then(n=>e.resolve("function"==typeof t?t():t).then(()=>n),n=>e.resolve("function"==typeof t?t():t).then(()=>{throw n}))}static resolve(t){return t instanceof e?t:new e(e=>e(t))}static reject(t){return new e((e,n)=>n(t))}static all(t){return new e((n,o)=>{if(!t||"function"!=typeof t[Symbol.iterator])return o(new TypeError("Argument is not iterable"));const r=Array.from(t),s=new Array(r.length);let i=r.length;if(0===i)return n(s);r.forEach((t,r)=>{e.resolve(t).then((e=>t=>{s[e]=t,0===--i&&n(s)})(r),o)})})}static race(t){return new e((n,o)=>{if(!t||"function"!=typeof t[Symbol.iterator])return o(new TypeError("Argument is not iterable"));for(const r of t)e.resolve(r).then(n,o)})}static allSettled(t){return new e((n,o)=>{if(!t||"function"!=typeof t[Symbol.iterator])return o(new TypeError("Argument is not iterable"));const r=Array.from(t),s=new Array(r.length);let i=r.length;if(0===i)return n(s);const a=e=>t=>o=>{s[e]={status:t,value:o},0===--i&&n(s)};r.forEach((t,n)=>{e.resolve(t).then(a(n)("fulfilled"),e=>a(n)("rejected")(e))})})}static any(t){return new e((n,o)=>{if(!t||"function"!=typeof t[Symbol.iterator])return o(new TypeError("Argument is not iterable"));const r=Array.from(t),s=new Array(r.length);let i=0;if(0===r.length)return o(new AggregateError([],"No Promise in MyPromise.any was resolved"));r.forEach((t,a)=>{e.resolve(t).then(n,e=>{s[a]=e,++i===r.length&&o(new AggregateError(s,"No Promise in MyPromise.any was resolved"))})})})}toString(){return"[object MyPromise]"}[Symbol.toStringTag]="MyPromise";resolvePromise(e,t,n,o){if(e===t)return o(new TypeError("Chaining cycle detected for promise"));let r=!1;if(!t||"object"!=typeof t&&"function"!=typeof t)n(t);else try{const s=t.then;"function"==typeof s?s.call(t,t=>{r||(r=!0,this.resolvePromise(e,t,n,o))},e=>{r||(r=!0,o(e))}):n(t)}catch(e){r||(r=!0,o(e))}}}return"undefined"!=typeof module&&module.exports?(module.exports=e,module.exports.default=e):"function"==typeof define&&define.amd?define([],()=>({default:e,__esModule:!0})):"undefined"!=typeof window&&(window.MyPromise=e),e});
